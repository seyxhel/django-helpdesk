{% extends "helpdesk/base.html" %}
{% load i18n %}

{% block helpdesk_title %}Service Level Agreement{% endblock %}

{% block helpdesk_head %}
<style>
    .sla-container { max-width:980px; margin:18px auto; background:#fff; border-radius:12px; padding:18px; border:1px solid rgba(15,23,42,0.06); }
    .sla-hero { display:flex; gap:18px; align-items:flex-start; }
    .sla-basics { flex:1; }
    .sla-policy { flex:1; }
    .sla-policy table { width:100%; border-collapse:collapse; }
    .sla-policy th, .sla-policy td { padding:8px 10px; border-bottom:1px solid rgba(15,23,42,0.06); text-align:left; }
    .sla-policy th { background:transparent; font-weight:700; }
    .status-chip { display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; font-weight:600; }
    .status-chip.green { background:#e6f6ee; color:#0b7a3a; }
    .status-chip.yellow { background:#fff8e6; color:#a66b00; }
    .status-chip.red { background:#fff4f4; color:#a61a1a; }
    .sla-ticket-list { margin-top:16px; }
        .sla-ticket { display:flex; justify-content:space-between; gap:12px; padding:10px; border-radius:8px; border:1px solid rgba(15,23,42,0.04); margin-bottom:8px; }
        /* priority color indicators for table rows */
        .priority-1 { border-left:6px solid #d9534f; }
        .priority-2 { border-left:6px solid #f0ad4e; }
        .priority-3 { border-left:6px solid #ffc107; }
        .priority-4, .priority-5 { border-left:6px solid #0b7a3a; }
    .sla-ticket .left { display:flex; gap:12px; align-items:center; }
    .sla-ticket .meta { color:#6c7783; font-size:.95rem; }
</style>
{% endblock %}

{% block helpdesk_breadcrumb %}
<li class="breadcrumb-item active">{% trans "Service Level Agreement" %}</li>
{% endblock %}

{% block helpdesk_body %}
<div class="sla-container">
    <div class="sla-hero">
        <div class="sla-basics">
            <h2>{% trans "SLA Basics" %}</h2>
            <p><strong>{% trans "Response Time" %}</strong> ‚Äî {% trans "How fast you must acknowledge a ticket." %}</p>
            <p><strong>{% trans "Resolution Time" %}</strong> ‚Äî {% trans "How fast you must resolve it." %}</p>
            <p><strong>{% trans "Escalation" %}</strong> ‚Äî {% trans "What happens if SLA is breached." %}</p>

            <h3 style="margin-top:12px;">{% trans "Responsibilities for Staff" %}</h3>
            <ul>
                <li>{% trans "Work on My Assigned Tickets only." %}</li>
                <li>{% trans "Update ticket status regularly." %}</li>
                <li>{% trans "Escalate or request help if nearing SLA breach." %}</li>
            </ul>

            <h3 style="margin-top:12px;">{% trans "Notifications" %}</h3>
            <ul>
                <li>{% trans "Alerts before SLA breach." %}</li>
                <li>{% trans "Notification if ticket is reassigned." %}</li>
            </ul>
        </div>

        <div class="sla-policy">
            <h2>{% trans "SLA Policy" %}</h2>
            <table aria-describedby="sla-policy-desc">
                <thead>
                    <tr>
                        <th>{% trans "Priority" %}</th>
                        <th>{% trans "Response Time" %}</th>
                        <th>{% trans "Resolution Time" %}</th>
                        <th>{% trans "Escalation" %}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>üî¥ {% trans "Critical" %}</td>
                        <td>15 min</td>
                        <td>4 hrs</td>
                        <td>{% trans "Escalates to Admin" %}</td>
                    </tr>
                    <tr>
                        <td>üü† {% trans "High" %}</td>
                        <td>30 min</td>
                        <td>8 hrs</td>
                        <td>{% trans "Escalates after 2 hrs" %}</td>
                    </tr>
                    <tr>
                        <td>üü° {% trans "Medium" %}</td>
                        <td>2 hrs</td>
                        <td>24 hrs</td>
                        <td>{% trans "Escalates after 6 hrs" %}</td>
                    </tr>
                    <tr>
                        <td>üü¢ {% trans "Low" %}</td>
                        <td>4 hrs</td>
                        <td>3 days</td>
                        <td>{% trans "Escalates after 1 day" %}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <h3 style="margin-top:18px;">{% trans "Ticket SLA Status" %}</h3>
        <div class="sla-ticket-list">
            <table class="table" style="width:100%; border-collapse:collapse">
                <thead>
                    <tr>
                        <th style="text-align:left">{% trans "Ticket" %}</th>
                        <th>{% trans "Priority" %}</th>
                        <th>{% trans "SLA Status" %}</th>
                        <th>{% trans "Time to Respond" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tickets %}
                    {% comment %} Map priority to colors: 1- Critical (red), 2-High (orange), 3-Medium (yellow), 4-5 Low (green) {% endcomment %}
                            <tr class="priority-{{ t.priority }}">
                                            <td>
                                                            {% if t.kbitem and t.kbitem.category and t.kbitem.category.slug %}
                                                                <strong><a href="{% url 'helpdesk:view' t.pk %}">{{ t.kbitem.category.slug }}</a></strong>
                                                                ‚Äî
                                                            {% endif %}
                                                            <a href="{% url 'helpdesk:view' t.pk %}">{{ t.title|default:'' }}</a>
                                            </td>
                        <td>{{ t.get_priority_display }}</td>
                        <td>
                            {# Placeholder status - server-side logic needed to determine real status #}
                            <span class="status-chip {% if t.priority == 1 %}red{% elif t.priority == 2 %}yellow{% elif t.priority == 3 %}yellow{% else %}green{% endif %}">
                                {% if t.priority == 1 %}‚ùå {% trans "Breached" %}{% elif t.priority == 2 %}‚ö†Ô∏è {% trans "At risk" %}{% else %}‚úÖ {% trans "On track" %}{% endif %}
                            </span>
                        </td>
                        <td class="meta">{% trans "--" %}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">{% trans "No tickets assigned to you." %}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</div>
{% endblock %}
