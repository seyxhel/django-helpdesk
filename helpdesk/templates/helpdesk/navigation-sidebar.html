{% load i18n helpdesk_staff %}

  <!-- Sidebar -->
  <ul id="helpdesk-sidebar" class="sidebar navbar-nav">
  {% if user.is_superuser %}
    <li class="nav-item{% if 'dashboard' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:dashboard' %}">
        <i class="fas fa-fw fa-tachometer-alt"></i>
        <span>{% trans "Dashboard" %}</span>
      </a>
    </li>
    <li class="nav-item{% if 'tickets' in request.path and 'submit' not in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:list' %}">
        <i class="fas fa-fw fa-tasks"></i>
        <span>{% trans "All Tickets" %}</span>
      </a>
    </li>
    {# Saved Queries removed from sidebar per request #}
    <li class="nav-item{% if 'manage-queues' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:manage_queues' %}">
        <i class="fas fa-fw fa-cubes"></i>
        <span>{% trans "Manage Queries" %}</span>
      </a>
    </li>
    <li class="nav-item{% if 'checklist-templates' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:checklist_templates' %}">
        <i class="fas fa-fw fa-clipboard-list"></i>
        <span>{% trans "Checklist" %}</span>
      </a>
    </li>
  {# SLA link only for staff, not admin #}
    <li class="nav-item{% if 'reports' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:report_index' %}">
        <i class="fas fa-fw fa-chart-area"></i>
        <span>{% trans "Reports" %}</span>
      </a>
    </li>
    <li class="nav-item{% if 'users' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:user_list' %}">
        <i class="fas fa-fw fa-users"></i>
        <span>{% trans "Users" %}</span>
      </a>
    </li>
    {% if helpdesk_settings.HELPDESK_KB_ENABLED %}
      <li class="nav-item{% if 'kb' in request.path %} active{% endif %}">
        <a class="nav-link" href="{% url 'helpdesk:kb_index' %}">
          <i class="fas fa-fw fa-database"></i>
          <span>{% trans "Knowledgebase" %}</span>
        </a>
      </li>
    {% endif %}
  {% elif user.is_staff %}
  {# Only show these once for staff #}
    <li class="nav-item{% if 'dashboard' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:dashboard' %}">
        <i class="fas fa-fw fa-tachometer-alt"></i>
        <span>{% trans "Dashboard" %}</span>
      </a>
    </li>
    <li class="nav-item{% if 'my-assigned-tickets' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:my-assigned-tickets' %}">
        <i class="fas fa-fw fa-user-check"></i>
        <span>{% trans "My Assigned Tickets" %}</span>
      </a>
    </li>
  {# 'Submit a Ticket' removed for staff sidebar (page remains accessible by direct URL) #}
    <li class="nav-item{% if 'sla_staff' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:sla_staff' %}">
        <i class="fas fa-fw fa-clock"></i>
        <span>{% trans "Service Level Agreement" %}</span>
      </a>
    </li>
  {# Reports are only shown for superusers; hidden from regular staff #}
    {% if helpdesk_settings.HELPDESK_KB_ENABLED %}
      <li class="nav-item{% if 'kb' in request.path %} active{% endif %}">
        <a class="nav-link" href="{% url 'helpdesk:kb_index' %}">
          <i class="fas fa-fw fa-database"></i>
          <span>{% trans "Knowledgebase" %}</span>
        </a>
      </li>
    {% endif %}
    {% else %}
        {# Public menu: remove Homepage and reorder for regular users #}
    {% if user.is_authenticated %}
    <li class="nav-item{% if 'my-tickets' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:my-tickets' %}">
        <i class="fas fa-fw fa-tasks"></i>
        <span>{% trans "My Tickets" %}</span>
      </a>
    </li>
    <li class="nav-item{% if 'submit' in request.path %} active{% endif %}">
      <a class="nav-link" href="{% url 'helpdesk:submit' %}">
        <i class="fas fa-fw fa-plus-circle"></i>
        <span>{% trans "Submit a Ticket" %}</span>
      </a>
    </li>
    {% endif %}

        {% if helpdesk_settings.HELPDESK_KB_ENABLED %}
        <li class="nav-item{% if 'kb' in request.path %} active{% endif %}">
          <a class="nav-link" href="{% url 'helpdesk:kb_index' %}">
            <i class="fas fa-fw fa-database"></i>
            <span>{% trans "Knowledgebase" %}</span>
          </a>
        </li>
        {% endif %}
    {% endif %}
  </ul>

  {# Page-specific sidebar content can be injected by templates using this block. #}
  {% block helpdesk_sidebar %}{% endblock %}

  <script>
    (function(){
      var sidebar = document.getElementById('helpdesk-sidebar');
      if(!sidebar) return;

      // Ensure clicks on icons/links work when sidebar is collapsed.
      sidebar.addEventListener('click', function(e){
        var el = e.target;
        if(!el) return;
        // Find nearest anchor
        var a = el.closest ? el.closest('a') : null;
        if(!a) return;

        // If collapsed, handle dropdown toggles specially and allow normal links to navigate
        if(sidebar.classList.contains('collapsed')){
          var parent = a.closest('.nav-item');
          var menu = parent ? parent.querySelector('.dropdown-menu') : null;

          if(menu){
            // Sidebar is collapsed â€” do NOT open dropdowns unless the user explicitly toggles the sidebar.
            // Prevent default anchor behavior (and avoid accidental expansion/jumps).
            e.preventDefault();
            return;
          }

          // If the anchor is a pure '#' do not navigate (prevent jump)
          var href = a.getAttribute('href') || '';
          if(href.trim() === '#'){
            e.preventDefault();
            return;
          }

          // Otherwise, allow navigation to proceed (click will follow the link)
        }
      });
    })();
    </script>
