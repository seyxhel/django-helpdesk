{% extends "helpdesk/base.html" %}

{% block title %}User settings{% endblock %}

{% block helpdesk_head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;600&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<style>
    /* Reset-card layout (match password-change look) */
    :root { --input-padding-x: 0.75rem; --input-padding-y: 0.75rem; }
    .reset-wrapper { padding: 40px 20px; display:flex; align-items:center; justify-content:center; }
  .reset-card { width: 540px; max-width:94%; padding: 28px; border-radius: 12px; background: #fff; box-shadow: 0 6px 18px rgba(0,0,0,0.06); border: 1px solid #e0e0e0; border-top: 0; }
    .reset-card h1 { margin: 0 0 6px 0; font-size: 20px; font-family: 'Montserrat', sans-serif; }
    .reset-card p { margin: 0 0 16px 0; color: #444; font-family: 'Roboto', sans-serif; font-size:13px; }

    .form-control { width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #ccc; font-size:13px; line-height:1.4; }
    .form-label { display:block; margin-bottom:8px; font-size:13px; color:#333; font-family: 'Roboto', sans-serif; }

    .reset-actions { display:flex; flex-direction:row; gap:12px; margin-top: 14px; align-items:center; justify-content:center; width:100%; }
    .btn-primary { min-width: 160px; padding: 8px 12px; border-radius: 12px; background-color: #000C7D; color: #ffffff; border: 1px solid #000C7D; font-weight: 500; text-align: center; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 14px; }
    .btn-primary:hover { background-color: #08104f; border-color: #08104f; }
    .btn-secondary { min-width: 140px; padding: 8px 12px; border-radius: 12px; background: #ffffff; border: 1px solid #9c9c9c; color: #333; text-align: center; display: inline-block; font-family: 'Poppins', sans-serif; font-size: 14px; }
    .helper-note { font-size: 13px; color: #666; margin-top: 10px; font-family: 'Roboto', sans-serif; }
    .field-error { color: #c62828; font-size: 12px; margin-top: 6px; display: inline-flex; align-items: center; gap: 6px; }
    .field-error::before { content: "\26A0"; font-size: 13px; line-height: 1; color: #c62828; }
    input.is-invalid, textarea.is-invalid { border-color: #c62828 !important; box-shadow: none !important; }

    body, .reset-card, .form-group, .form-text { font-family: 'Roboto', sans-serif; font-size: 13px; }
    .btn { font-family: 'Poppins', sans-serif; }
    @media (max-width: 480px) { .reset-actions { flex-direction: column; } .btn-primary, .btn-secondary { width: 90% !important; display: block; } }
</style>
{% endblock %}

{% block helpdesk_body %}
<div class="reset-wrapper">
  <div class="reset-card">
    <h1>User settings</h1>
    <p>Update your profile information below.</p>

    <form method="post" novalidate>
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="form-group mb-3">
        {{ form.first_name.label_tag }}
        {{ form.first_name }}
        {{ form.first_name.errors }}
      </div>

      <div class="form-group mb-3">
        {{ form.last_name.label_tag }}
        {{ form.last_name }}
        {{ form.last_name.errors }}
      </div>

      <div class="form-group mb-3">
        {{ form.username.label_tag }}
        {{ form.username }}
        {{ form.username.errors }}
      </div>

      <div class="form-group mb-3">
        {{ form.email.label_tag }}
        {{ form.email }}
        {{ form.email.errors }}
      </div>

      <div class="reset-actions">
  <a class="btn-secondary" href="http://127.0.0.1:8000/tickets/my-assigned-tickets/">Cancel</a>
        <button type="submit" class="btn-primary">Save changes</button>
      </div>

    </form>
    {% if request.GET.updated %}
      <div id="profile-success-overlay" aria-hidden="true" style="display:none; position:fixed; inset:0; z-index:1200; align-items:center; justify-content:center;">
        <div id="profile-success-backdrop" style="background: rgba(0,0,0,0.4); position:absolute; inset:0;"></div>
        <div style="position:relative; z-index:1201; display:flex; align-items:center; justify-content:center;">
          <div id="profile-success-card" role="status" aria-live="polite" style="width:420px; max-width:94vw; background:#fff; border-radius:12px; padding:28px; box-shadow:0 10px 40px rgba(0,0,0,0.2); text-align:center; transition: transform 250ms ease, opacity 250ms ease;">
            <!-- animated check circle -->
            <svg width="84" height="84" viewBox="0 0 120 120" style="display:block;margin:0 auto 12px auto;">
              <circle cx="60" cy="60" r="48" stroke="#0f9d58" stroke-width="6" fill="none" stroke-dasharray="302" stroke-dashoffset="302">
                <animate attributeName="stroke-dashoffset" from="302" to="0" dur="0.45s" fill="freeze" />
              </circle>
              <path d="M40 62 L54 76 L82 46" stroke="#0f9d58" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0">
                <animate attributeName="opacity" from="0" to="1" begin="0.4s" dur="0.15s" fill="freeze" />
              </path>
            </svg>
            <h2 style="margin:0 0 8px 0; font-size:20px;">Success!</h2>
            <p id="profile-success-text" style="margin:0; color:#444;">Profile Updated.</p>
          </div>
        </div>
      </div>
      <script>
      (function(){
        var overlay = document.getElementById('profile-success-overlay');
        var card = document.getElementById('profile-success-card');
        if(overlay && card) {
          overlay.style.display = 'flex';
          overlay.setAttribute('aria-hidden','false');
          card.style.transform = 'translateY(-6px)';
          card.style.opacity = '1';
          setTimeout(function(){
            try {
              var url = new URL(window.location.href);
              url.searchParams.delete('updated');
              window.history.replaceState({}, document.title, url.pathname + url.search + url.hash);
            } catch (e) {}
            overlay.style.display = 'none';
          }, 1400);
        }
      })();
      </script>
    {% endif %}
  </div>
</div>
{% endblock %}
