{% extends "helpdesk/base.html" %}{% load i18n %}

{% block helpdesk_title %}{% trans "Reports &amp; Statistics" %}{% endblock %}

{% block helpdesk_breadcrumb %}
<li class="breadcrumb-item">
    <a href="{% url 'helpdesk:report_index' %}">{% trans "Reports &amp; Statistics" %}</a>
</li>
<li class="breadcrumb-item active">Overview</li>
{% endblock %}

{% block helpdesk_body %}
<style>
  :root{
    --rh-bg: #ffffff;
    --muted: #6c7783;
    --ink: #0f2b44;
    --accent: #0b57d0;
    --card-accent: #eef7ff;    /* soft blue for stat cards */
    --card-accent-2: #f3f8ff;  /* lighter for links */
    --card-border: rgba(15,23,42,0.06);
    --radius: 12px;
    --gap: 16px;
  }

  /* Card: flat, subtle border, consistent radius */
  .card.mb-3 {
    background: var(--rh-bg);
    border: 1px solid var(--card-border);
    border-radius: var(--radius);
    box-shadow: none;
    overflow: visible;
  }

  /* Tidy card header / body for consistent, professional spacing */
  .card.mb-3 .card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    font-size: 16px;
    font-weight: 600;
    background: transparent;
    border-bottom: 1px solid rgba(15,23,42,0.03);
    color: var(--ink);
  }
  .card.mb-3 .card-body {
    padding: 14px 16px;
  }

  /* Stats area: responsive two-column grid, equal height rows */
  .report-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: 1fr;     /* make all stat cells equal height */
    gap: 12px;
    align-items: stretch;    /* stretch children to full row height */
  }
  @media (max-width: 720px) {
    .report-stats { grid-template-columns: 1fr; }
  }
  .report-stats .stat {
    display: flex;
    flex-direction: column;
    background: var(--card-accent);
    border: 1px solid rgba(11,87,208,0.08);
    padding: 14px;
    border-radius: 10px;
    min-height: 120px; /* ensures visually balanced cards */
  }
  .report-stats .stat .label { color: var(--muted); font-size: 13px; }
  .report-stats .stat .value { font-weight:700; color: var(--accent); font-size: 20px; margin-top:6px; display:block; }

  /* Tables: compact, clean, and readable */
  .table {
    border-collapse: collapse;
    border: 0;
    margin-bottom: 0;
    font-size: 14px;
  }

  /* -------- Professional table container & look -------- */
  .table-responsive-professional {
    margin-top: 8px;
    border: 1px solid rgba(15,23,42,0.06);   /* subtle outer border */
    border-radius: 10px;                      /* rounded container */
    overflow: hidden;
    background: #fff;
  }

  /* Base table behavior */
  .professional-table {
    width: 100%;
    margin-bottom: 0;
    border-collapse: collapse; /* keep cells tight inside wrapper */
    background: transparent;
    font-size: 0.95rem;
  }

  /* Header style */
  .professional-table thead th {
    background: linear-gradient(180deg, #f8f9fb 0%, #f4f6f8 100%);
    color: #0f1724;
    font-weight: 600;
    padding: 12px 14px;
    text-align: left;
    border-bottom: 1px solid rgba(15,23,42,0.06);
    vertical-align: middle;
  }

  /* Table cells */
  .professional-table tbody td {
    padding: 12px 14px;
    vertical-align: middle;
    border-bottom: 1px solid rgba(15,23,42,0.04);
    color: #111827;
  }

  /* Remove final row divider for a cleaner bottom edge */
  .professional-table tbody tr:last-child td {
    border-bottom: none;
  }

  /* Row hover and stripe */
  .professional-table tbody tr:hover {
    background: rgba(11,94,215,0.03);
  }
  .professional-table.table-striped tbody tr:nth-of-type(odd) {
    background: rgba(0,0,0,0.02);
  }

  /* Ticket title link */
  .tickettitle a { color: #0b5ed7; text-decoration: none; }
  .tickettitle a:hover { text-decoration: underline; }

  /* Compact table adjustments (used when compact_layout=True) */
  .tickets-card-compact .professional-table thead th {
    padding: .45rem .6rem;
  }
  .tickets-card-compact .professional-table tbody td {
    padding: .45rem .6rem;
  }

  /* Generate Report: two-column grid of nicely styled action tiles */
  .report-links {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin: 0;
    padding: 4px 0 0 0;
  }
  .report-links a {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 10px 14px;
    border-radius: 10px;
    background: #ffffff;
    border: 1px solid rgba(11,87,208,0.06);
    color: var(--accent);
    text-decoration: none;
    box-shadow: 0 1px 0 rgba(15,23,42,0.02) inset;
    transition: background .12s ease, transform .06s ease;
    font-weight: 600;
  }
  .report-links a:hover {
    background: rgba(11,87,208,0.06);
    transform: translateY(-1px);
    text-decoration: none;
  }
  /* optional right-side chevron for clarity */
  .report-links a::after {
    content: "›";
    color: rgba(11,87,208,0.65);
    font-weight: 700;
    margin-left: 8px;
  }

  /* Small screens */
  @media (max-width: 576px) {
    .professional-table thead th,
    .professional-table tbody td { padding: .5rem .6rem; }
  }
  @media (max-width: 720px) {
    .report-links { grid-template-columns: 1fr; }
    .report-links a { padding: 12px 14px; border-radius: 8px; }
  }

  /* Small helpers */
  .muted-note { color: var(--muted); font-size: 13px; }
  .icon-faint { color: rgba(15,23,42,0.5); margin-right: 8px; }
</style>

<h2>{% trans "Reports &amp; Statistics" %}</h2>

{% if number_tickets == 0 %}
<p>{% trans "You haven't created any tickets yet, so you cannot run any reports." %}</p>
{% else %}

<div class="card mb-3">
    <div class="card-header">
        <i class="fas fa-info-circle icon-faint"></i>
        {% trans "Current Ticket Stats" %}
    </div>
    <div class="card-body">
        <div class="report-stats">
            <div class="stat">
                <div class="label">{% trans "Average days until closed (all tickets)" %}</div>
                <div class="value">{{ basic_ticket_stats.average_nbr_days_until_ticket_closed|floatformat:2 }}</div>
            </div>
            <div class="stat">
                <div class="label">{% trans "Average days until closed (last 60 days)" %}</div>
                <div class="value">{{ basic_ticket_stats.average_nbr_days_until_ticket_closed_last_60_days|floatformat:2 }}</div>
                <div class="muted-note" style="margin-top:8px;">{% trans "See detailed average by month" %} — <a href="{% url 'helpdesk:report_index' %}daysuntilticketclosedbymonth">{% trans "details" %}</a></div>
            </div>
        </div>

        <div style="height:12px;"></div>

        <div class="table-responsive-professional">
            <table class="professional-table table-striped">
                 <thead>
                     <tr>
                         <th>{% trans "Queue" %}</th>
                         <th>{% trans "Open" %}</th>
                         <th>{% trans "Resolved" %}</th>
                         <th>{% trans "Closed" %}</th>
                         {% if helpdesk_settings.HELPDESK_ENABLE_TIME_SPENT_ON_TICKET %}<th>{% trans "Time spent" %}</th>{% endif %}
                     </tr>
                 </thead>
                 <tbody>
                     {% for queue in dash_tickets %}
                     <tr>{% url 'helpdesk:list' as hdlist %}
                         <td><a href='{{ hdlist }}?queue={{ queue.queue }}&status=1&status=2'>{{ queue.name }}</a></td>
                         <td>{% if queue.open %}<a href='{{ hdlist }}?queue={{ queue.queue }}&status=1&status=2'>{% endif %}{{ queue.open }}{% if queue.open %}</a>{% endif %}</td>
                         <td>{% if queue.resolved %}<a href='{{ hdlist }}?queue={{ queue.queue }}&status=3'>{% endif %}{{ queue.resolved }}{% if queue.resolved %}</a>{% endif %}</td>
                         <td>{% if queue.closed %}<a href='{{ hdlist }}?queue={{ queue.queue }}&status=4'>{% endif %}{{ queue.closed }}{% if queue.closed %}</a>{% endif %}</td>
                         {% if helpdesk_settings.HELPDESK_ENABLE_TIME_SPENT_ON_TICKET %}<td>{{ queue.time_spent }}{% if queue.dedicated_time %} / {{ queue.dedicated_time }}{% endif %}</td>{% endif %}
                     </tr>
                     {% empty %}
                     <tr><td colspan='6'>{% trans "There are no unassigned tickets." %}</td></tr>
                     {% endfor %}
                 </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card mb-3">
    <div class="card-header">
        <i class="fas fa-print icon-faint"></i>
        {% trans "Generate Report" %}
    </div>
    <div class="card-body">
        <div class="report-links" role="list">
            <a href='userpriority/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by User — Priority" %}</a>
            <a href='userqueue/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by User — Queue" %}</a>
            <a href='userstatus/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by User — Status" %}</a>
            <a href='usermonth/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by User — Month" %}</a>

            <a href='queuepriority/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by Queue — Priority" %}</a>
            <a href='queuestatus/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by Queue — Status" %}</a>
            <a href='queuemonth/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Reports by Queue — Month" %}</a>
            <a href='daysuntilticketclosedbymonth/{% if saved_query %}?saved_query={{ saved_query }}{% endif %}'>{% trans "Days until ticket closed by Month" %}</a>
        </div>
    </div>
</div>

{% endif %}
{% endblock %}
