{% load i18n humanize %}

<style>
/* -------- General card / compact styles (existing) -------- */
.tickets-card-compact {
  margin: 8px auto 12px;           /* less top/bottom and side margin */
  max-width: 1100px;               /* keep a comfortable max width */
}
.tickets-card-compact .card-body {
  padding: 12px 14px;              /* tighter padding inside card */
}
.tickets-card-compact .tickets-filters {
  margin-bottom: 8px;
}
.tickets-card-compact .table-responsive-professional {
  margin: 0;
}
.tickets-card-compact .professional-table th,
.tickets-card-compact .professional-table td {
  padding: .45rem .6rem;           /* reduce cell padding for denser table */
  vertical-align: middle;
}
.tickets-card-compact .card-header { padding: .75rem 14px; }
.tickets-card-compact .card-footer { padding: .5rem 14px; font-size: .85rem; }

/* Reduce vertical gap between header text and the table */
.card-header {
  padding-bottom: 6px; /* tighten space under header */
}
.card-header .small.text-muted {
  margin-bottom: 0;
  line-height: 1.1;
  font-size: .85rem;
}
.card-body {
  padding-top: 8px; /* reduce space above card body */
}
.tickets-filters {
  margin: 0 0 6px 0 !important; /* remove large bottom margin from empty/compact filters */
}

/* -------- Professional table container & look -------- */
.table-responsive-professional {
  margin-top: 0;
  border: 1px solid rgba(15,23,42,0.06);   /* subtle outer border */
  border-radius: 10px;                      /* rounded container */
  overflow: hidden;
  background: #fff;
}

/* Base table behavior */
.professional-table {
  width: 100%;
  margin-bottom: 0;
  border-collapse: collapse; /* keep cells tight inside wrapper */
  background: transparent;
  font-size: 0.95rem;
}

/* Header style */
.professional-table thead th {
  background: linear-gradient(180deg, #f8f9fb 0%, #f4f6f8 100%);
  color: #0f1724;
  font-weight: 600;
  padding: 0.65rem 0.9rem;
  text-align: left;
  border-bottom: 1px solid rgba(15,23,42,0.06);
  vertical-align: middle;
}

/* Table cells */
.professional-table tbody td {
  padding: 0.55rem 0.9rem;
  vertical-align: middle;
  border-bottom: 1px solid rgba(15,23,42,0.04);
  color: #111827;
}

/* Remove final row divider for a cleaner bottom edge */
.professional-table tbody tr:last-child td {
  border-bottom: none;
}

/* Row hover and stripe */
.professional-table tbody tr:hover {
  background: rgba(11,94,215,0.03);
}
.professional-table.table-striped tbody tr:nth-of-type(odd) {
  background: rgba(0,0,0,0.02);
}

/* Ticket title link */
.tickettitle a { color: #0b5ed7; text-decoration: none; }
.tickettitle a:hover { text-decoration: underline; }

/* Compact table adjustments (used when compact_layout=True) */
.tickets-card-compact .professional-table thead th {
  padding: .45rem .6rem;
}
.tickets-card-compact .professional-table tbody td {
  padding: .45rem .6rem;
}

/* Small screens */
@media (max-width: 576px) {
  .professional-table thead th,
  .professional-table tbody td { padding: .5rem .6rem; }
}
</style>

{# allow callers to request a rounded card for staff assigned tickets #}
{# add an optional compact layout by passing compact_layout=True #}
{% if assigned_card %}
  {% if compact_layout %}
    <div class="card mb-3 card-assigned-rounded tickets-card-compact">
  {% else %}
    <div class="card mb-3 card-assigned-rounded">
  {% endif %}
{% else %}
  {% if compact_layout %}
    <div class="card mb-3 tickets-card-compact">
  {% else %}
    <div class="card mb-3">
  {% endif %}
{% endif %}
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <i class="fas fa-table"></i>
      <strong>
        {% if ticket_list_caption %}{{ ticket_list_caption }}{% else %}{% trans "Your Tickets" %}{% endif %}
      </strong>
      <div class="small text-muted">{% trans "Use the controls to narrow results. Filters are applied when you submit." %}</div>
    </div>
  </div>
 
  <div class="card-body">
    <!-- Consolidated filter bar: appears before the table for clarity -->
    <div class="tickets-filters mb-3">
    </div>
 
    <div class="table-responsive-professional">
      <table class="professional-table table-sm table-striped" id="dataTable" width="100%" cellspacing="0" role="table" aria-label="{% trans 'Tickets table' %}">
        <thead>
          <tr>
            <th>{% trans "Ticket" %}</th>
            <th>{% trans "Priority" %}</th>
            <th>{% trans "Queue" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Last Update" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for ticket in ticket_list %}
          <tr class="{{ ticket.get_priority_css_class }}">
            <td class="tickettitle">
              <a href="{{ ticket.get_absolute_url }}">{{ ticket.id }}. {{ ticket.title }}</a>
            </td>
            <td>{{ ticket.priority }}</td>
            <td>{{ ticket.queue }}</td>
            <td>{{ ticket.get_status }}</td>
            <td>
              <span title="{{ ticket.modified|date:'DATETIME_FORMAT' }}">{{ ticket.modified|naturaltime }}</span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-muted small">
              {% if ticket_list_empty_message %}{{ ticket_list_empty_message }}{% else %}{% trans "No tickets found for the selected filters." %}{% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- /.table-responsive -->
    {% if ticket_list.has_other_pages %}
      <nav aria-label="{% trans 'Ticket pagination' %}" class="mt-3">
        <ul class="pagination">
          {% if ticket_list.has_previous %}
            <li class="page-item"><a class="page-link" href="?{{ page_var }}=1">&laquo;&laquo;</a></li>
            <li class="page-item"><a class="page-link" href="?{{ page_var }}={{ ticket_list.previous_page_number }}">&laquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;&laquo;</span></li>
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
          {% endif %}

          {% with 5 as thresh %}
          {% for i in ticket_list.paginator.page_range %}
            {% if ticket_list.number == i %}
              <li class="page-item active" aria-current="page"><span class="page-link">{{ i }}</span></li>
            {% elif i <= ticket_list.number|add:5 and i >= ticket_list.number|add:-5 %}
              <li class="page-item"><a class="page-link" href="?{{ page_var }}={{ i }}">{{ i }}</a></li>
            {% endif %}
          {% endfor %}
          {% endwith %}

          {% if ticket_list.has_next %}
            <li class="page-item"><a class="page-link" href="?{{ page_var }}={{ ticket_list.next_page_number }}">&raquo;</a></li>
            <li class="page-item"><a class="page-link" href="?{{ page_var }}={{ ticket_list.paginator.num_pages }}">&raquo;&raquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
            <li class="page-item disabled"><span class="page-link">&raquo;&raquo;</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>

  <div class="card-footer small text-muted">
    {% blocktrans count count=ticket_list|length %}
      Listing {{ count }} ticket.
    {% plural %}
      Listing {{ count }} tickets.
    {% endblocktrans %}
  </div>
</div>


