{% extends "helpdesk/base.html" %}{% load i18n %}
{% load static %}

{% block helpdesk_title %}{% trans "Reports &amp; Statistics" %}{% endblock %}

{% block helpdesk_head %}

{% endblock %}

{% block helpdesk_breadcrumb %}
<li class="breadcrumb-item">
  <a href="{% url 'helpdesk:report_index' %}">{% trans "Reports" %}</a>
</li>
<li class="breadcrumb-item active">{{ title }}</li>
{% endblock %}

{% block helpdesk_body %}
<style>
  /* -------- Professional table container & look -------- */
  .table-responsive-professional {
    margin-top: 0;
    border: 1px solid rgba(15,23,42,0.06);
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
  }

  /* Make all cards use a consistent 16px radius for a softer look */
  .card.mb-3 {
    border-radius: 16px;
  }
  
  /* Base table behavior */
  .professional-table {
    width: 100%;
    margin-bottom: 0;
    border-collapse: collapse;
    background: transparent;
    font-size: 0.95rem;
  }

  /* Header style */
  .professional-table thead th {
    background: linear-gradient(180deg, #f8f9fb 0%, #f4f6f8 100%);
    color: #0f1724;
    font-weight: 600;
    padding: 0.65rem 0.9rem;
    text-align: left;
    border-bottom: 1px solid rgba(15,23,42,0.06);
    vertical-align: middle;
  }

  /* Table cells */
  .professional-table tbody td {
    padding: 0.55rem 0.9rem;
    vertical-align: middle;
    border-bottom: 1px solid rgba(15,23,42,0.04);
    color: #111827;
  }

  /* Remove final row divider for a cleaner bottom edge */
  .professional-table tbody tr:last-child td {
    border-bottom: none;
  }

  /* Row hover and stripe */
  .professional-table tbody tr:hover {
    background: rgba(11,94,215,0.03);
  }
  .professional-table.table-striped tbody tr:nth-of-type(odd) {
    background: rgba(0,0,0,0.02);
  }

  /* Ticket title link */
  .tickettitle a { color: #0b5ed7; text-decoration: none; }
  .tickettitle a:hover { text-decoration: underline; }

  /* Compact table adjustments (used when compact_layout=True) */
  .tickets-card-compact .professional-table thead th {
    padding: .45rem .6rem;
  }
  .tickets-card-compact .professional-table tbody td {
    padding: .45rem .6rem;
  }

  /* Small screens */
  @media (max-width: 576px) {
    .professional-table thead th,
    .professional-table tbody td { padding: .5rem .6rem; }
  }
</style>

<h2>{% trans "Reports &amp; Statistics" %}</h2>


<div class="card mb-3">
    <div class="card-header" style= "border-radius: 16px;">
        <i class="fas fa-chart-line"></i>
        {{ title }}
    </div>
    <div class="card-body">
        <div class="table-responsive-professional">
            <table class="professional-table table-striped">
                 <thead>
                     <tr>{% for h in headings %} 
                         <th>{% if forloop.first %}{{ h|title }}{% else %}{{ h }}{% endif %}</th>{% endfor %}
                     </tr>
                 </thead>
                 <tbody>
                     {% for d in data %}
                     <tr class='row_{% cycle 'odd' 'even' %}'>
                         {% for f in d %}<td class='report'>{{ f }}</td>{% endfor %}
                     </tr>
                     {% endfor %}
                     <tr>
                         {% for f in total_data %}<td class='report'>{{ f }}</td>{% endfor %}
                     </tr>
                 </tbody>
            </table>
        </div>
        <!-- /.table-responsive -->
    </div>
    <!-- /.card-body -->
</div>
<!-- /.card -->

<div class="card mb-3">
    <div class="card-header"  style= "border-radius: 16px;">
        <i class="fas fa-chart-line"></i>
        {% trans "Chart" %}
    </div>
    <div class="card-body">
        <div class="flot-chart">
            <div class="flot-chart-content" id="chart-content"></div>
        </div>
    </div>
</div>
<!-- /.card -->

{% endblock %}


{% block helpdesk_js %}

    <!-- Flot Charts JavaScript -->
    <script src="/static/helpdesk/vendor/flot/excanvas.min.js"></script>
    <script src="/static/helpdesk/vendor/flot/jquery.flot.js"></script>
    <script src="/static/helpdesk/vendor/flot/jquery.flot.categories.js"></script>
    <script src="/static/helpdesk/vendor/flot/jquery.flot.pie.js"></script>
    <script src="/static/helpdesk/vendor/flot/jquery.flot.resize.js"></script>
    <script src="/static/helpdesk/vendor/flot/jquery.flot.time.js"></script>
    <script src="/static/helpdesk/vendor/flot-tooltip/jquery.flot.tooltip.min.js"></script>

    <!-- Morris Charts JavaScript -->
    {% if helpdesk_settings.HELPDESK_USE_CDN %}
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    {% else %}
    <script src="{% static 'helpdesk/vendor/raphael/raphael.min.js' %}"></script>
    <script src="{% static 'helpdesk/vendor/morrisjs/morris.min.js' %}"></script>
    {% endif %}

{% if charttype == "date" %}
<script type='text/javascript'>

Morris.Line({
  element: 'chart-content',
  data: {% autoescape on %}{{ morrisjs_data|safe }}{% endautoescape %},
  xkey: 'x',
  ykeys: [{% for d in data %}{{ forloop.counter0 }}{% if not forloop.last %}, {% endif %}{% endfor %}],
  labels: [{% for n in series_names %}"{{ n }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
  xLabels: "month"
});

</script>
{% endif %}
{% if charttype == "bar" %}
<script type='text/javascript'>

Morris.Bar({
  element: 'chart-content',
  data: {% autoescape on %}{{ morrisjs_data|safe }}{% endautoescape %},
  xkey: 'x',
  ykeys: [{% for d in data %}{{ forloop.counter0 }}{% if not forloop.last %}, {% endif %}{% endfor %}],
  labels: [{% for n in series_names %}"{{ n }}"{% if not forloop.last %}, {% endif %}{% endfor %}]
});

</script>
{% endif %}



{% endblock %}
